var jsonfile=require("jsonfile"),path=require("path"),setting=path.join(__dirname,"../config/oxd.setting.json"),oxd=require("oxd-node");module.exports=function(router){router.get("/authen",(req,res)=>{req.session.destroy(err=>{if(err)console.log(err);else{res.clearCookie("tpb-userprofile")}});jsonfile.readFile(setting,function(err,obj){if(""!=obj.oxd_id){oxd.Request.oxd_id=obj.oxd_id;oxd.get_authorization_url(oxd.Request,function(response){response=JSON.parse(response);res.redirect(response.data.authorization_url)})}else{var data={error:"please register first."};res.json(data)}})});router.get("/GetLogoutUri",function(req,res){if(req.session.userprofile){jsonfile.readFile(setting,function(err,obj){if(""!=obj.oxd_id){oxd.Request.oxd_id=obj.oxd_id;oxd.get_logout_uri(oxd.Request,function(response){response=JSON.parse(response);var data={logoutUri:response.data.uri};req.session.destroy(err=>{if(err)console.log(err);else{res.clearCookie("tpb-userprofile");res.send(data)}})})}else{var err={error:"please register first."};res.send(err)}})}else res.send({logoutUri:"https://watch.tanpibut.org"})});return router};